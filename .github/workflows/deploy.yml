name: üöÄ Deploy to Server

on:
  push:
    branches:
      - main  # –ú–µ–Ω—è–π –Ω–∞ —Å–≤–æ—é –æ—Å–Ω–æ–≤–Ω—É—é –≤–µ—Ç–∫—É

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: üì• –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
        uses: actions/checkout@v4

      - name: üîë –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º SSH –∫–ª—é—á
        uses: webfactory/ssh-agent@v0.5.4
        with:
          ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

      - name: üöÄ –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É –∏ –¥–µ–ø–ª–æ–∏–º
        run: |
          ssh -o StrictHostKeyChecking=no root@89.111.152.238 << 'EOF'
            cd /home/VehiclePark  # –ü–∞–ø–∫–∞ —Å –ø—Ä–æ–µ–∫—Ç–æ–º
            git pull origin main            # –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–¥
            docker compose down             # –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
            docker compose up -d --build    # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
            docker system prune -f          # –ß–∏—Å—Ç–∏–º –Ω–µ–Ω—É–∂–Ω–æ–µ
          EOF
