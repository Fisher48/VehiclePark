<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç—á—ë—Ç—ã</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container mt-4">

<h1 th:align="center">–§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞</h1>

<hr>

<form th:action="@{/managers/reports/generate}" method="post">

    <div class="col-md-3">
        <label for="reportType">–¢–∏–ø –æ—Ç—á–µ—Ç–∞</label>
        <select id="reportType" name="reportType" class="form-control" required>
            <option th:each="type : ${reportTypes}" th:value="${type}" th:text="${type.title}"></option>
        </select>
    </div>

    <br>

    <div id="enterpriseSelect" class="col-md-3" style="display: none;">
        <label for="enterpriseId">–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ</label>
        <select id="enterpriseId" name="enterpriseId" class="form-control">
            <option th:each="enterprise : ${enterprises}" th:value="${enterprise.id}" th:text="${enterprise.name}"></option>
        </select>
    </div>

<!--    <div id="vehicleSelect" class="col-md-3" style="display: none;">-->
<!--        <label for="vehicleId">–ê–≤—Ç–æ–º–æ–±–∏–ª—å</label>-->
<!--        <select id="vehicleId" name="vehicleId" class="form-control">-->
<!--            <option th:each="vehicle : ${vehicles}" th:value="${vehicle.id}" th:text="${vehicle.number}"></option>-->
<!--        </select>-->
<!--    </div>-->

    <div id="vehicleSelect" class="col-md-3" style="display: none;">
        <label for="vehicleNumber">–ì–æ—Å. –Ω–æ–º–µ—Ä –∞–≤—Ç–æ–º–æ–±–∏–ª—è</label>
        <input type="text" id="vehicleNumber" name="vehicleNumber"
               class="form-control" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: A123BC77">
    </div>


    <div class="row g-3 mt-3">

        <div class="col-md-3">
        <label for="period">–ü–µ—Ä–∏–æ–¥</label>
        <select id="period" name="period" class="form-control" required>
            <option th:each="period : ${periods}" th:value="${period}" th:text="${period.getTitle()}"></option>
        </select>
        </div>

        <div class="col-md-3">
        <label for="startDate">–ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞</label>
        <input type="datetime-local" id="startDate" name="startDate" class="form-control" required>
        </div>

        <div class="col-md-3">
        <label for="endDate">–ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞</label>
        <input type="datetime-local" id="endDate" name="endDate" class="form-control" required>
        </div>

        <div class="mt-4">
        <button type="submit" class="btn btn-primary" id="submitButton">–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á–µ—Ç</button>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
        <button class="btn btn-primary d-none" type="button" id="loadingButton" disabled>
            <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
            <span role="status">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
        </button>

        <div class="mt-4">
            <a th:href="@{/managers/enterprises}"
               class="btn btn-secondary">–ö —Å–ø–∏—Å–∫—É –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π</a>
        </div>

    </div>

</form>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const form = document.querySelector("form"); // –ù–∞—Ö–æ–¥–∏–º —Ñ–æ—Ä–º—É
        const submitButton = document.getElementById("submitButton"); // –û–±—ã—á–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
        const loadingButton = document.getElementById("loadingButton"); // –ö–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏

        const reportTypeSelect = document.getElementById('reportType');
        const enterpriseSelect = document.getElementById('enterpriseSelect');
        const vehicleSelect = document.getElementById('vehicleSelect');

        function updateVisibility() {
            const selectedType = reportTypeSelect.value;
            enterpriseSelect.style.display = selectedType === 'ENTERPRISE_MILEAGE' ? 'block' : 'none';
            vehicleSelect.style.display = selectedType === 'VEHICLE_MILEAGE' ? 'block' : 'none';
        }

        reportTypeSelect.addEventListener('change', updateVisibility);
        updateVisibility(); // üí• –∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ

        form.addEventListener("submit", function () {
        // –°–∫—Ä—ã–≤–∞–µ–º –æ–±—ã—á–Ω—É—é –∫–Ω–æ–ø–∫—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∑–∞–≥—Ä—É–∑–∫–∏
            submitButton.classList.add("d-none");
            loadingButton.classList.remove("d-none");
        });
    });
</script>

</body>
</html>