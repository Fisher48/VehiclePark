#!/bin/bash

set -e  # ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ ัะบัะธะฟั ะฟัะธ ะพัะธะฑะบะต

# ๐น ะะะะะซะ ะะะฏ ะะะะะะฎะงะะะะฏ
SERVER_USER="root"   # <-- ะฃะบะฐะถะธ ะฟะพะปัะทะพะฒะฐัะตะปั ะฝะฐ ัะตัะฒะตัะต
SERVER_HOST="89.111.152.238" # <-- ะฃะบะฐะถะธ IP ะธะปะธ ะดะพะผะตะฝ ัะตัะฒะตัะฐ
SERVER_DIR="/VehiclePark"  # ะะฐะฟะบะฐ ะฝะฐ ัะตัะฒะตัะต

echo "๐ ะะตะฟะปะพะน ะฝะฐ $SERVER_HOST ะฒ $SERVER_DIR"

# 1 ะะพะฟะธััะตะผ ัะฐะนะปั ะฟัะพะตะบัะฐ ะฝะฐ ัะตัะฒะตั
echo "๐ ะะพะฟะธััะตะผ ัะฐะนะปั ะฝะฐ ัะตัะฒะตั..."
rsync -av --exclude='.git' --exclude='node_modules' --exclude='target' . "$SERVER_USER@$SERVER_HOST:$SERVER_DIR/"

# 2 ะะพะดะบะปััะฐะตะผัั ะฟะพ SSH ะธ ะฟะตัะตะทะฐะฟััะบะฐะตะผ ัะตัะฒะธัั
echo "๐ณ ะะตัะตะทะฐะฟััะบะฐะตะผ ะบะพะฝัะตะนะฝะตัั ะฝะฐ ัะตัะฒะตัะต..."
ssh "$SERVER_USER@$SERVER_HOST" <<EOF
  cd "$SERVER_DIR"
  docker-compose down || true
  docker-compose up -d --build
EOF

echo "โ ะะตะฟะปะพะน ะทะฐะฒะตััะตะฝ!"